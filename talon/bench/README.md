# Talon Benchmarks

This directory hosts lightweight benchmarks for Talon alongside a reference
implementation in pandas. The goal is to exercise the most common dataframe
workloads so we can spot performance regressions quickly.

## Fixtures

Synthetic CSV fixtures live in `./data/` and are generated by
`scripts/generate_fixtures.py`:

- `customers.csv` — 1.5k customer records with segments, regions, and loyalty
  metadata.
- `transactions.csv` — 40k point-of-sale transactions linked to customers with
  category, channel, discount, and amount columns.

Regenerate fixtures after modifying the generator or schema:

```bash
uv run python talon/bench/scripts/generate_fixtures.py
```

## Running the benchmarks

### Talon (OCaml)

```bash
dune exec talon/bench/bench_talon.exe
```

### Pandas (Python)

```bash
uv run --with pandas talon/bench/bench_talon.py
```

## Results Talon (Ocaml)

```
┌─────────────────────────────┬──────────┬──────────┬─────────┬─────────┬────────────┐
│ Name                        │ Wall/Run │  CPU/Run │ mWd/Run │ Speedup │ vs Fastest │
├─────────────────────────────┼──────────┼──────────┼─────────┼─────────┼────────────┤
│ Talon/Filter/high_value     │   9.93ms │   9.93ms │  1.38Mw │   1.00x │       100% │
│ Talon/Sort/amount_desc      │  32.02ms │  32.02ms │  2.75Mw │   0.31x │       322% │
│ Talon/Group/category_region │ 170.80ms │ 170.78ms │ 23.96Mw │   0.06x │      1720% │
│ Talon/Join/customer_lookup  │ 805.35ms │ 799.46ms │  3.39Mw │   0.01x │      8109% │
└─────────────────────────────┴──────────┴──────────┴─────────┴─────────┴────────────┘
```

## Results Pandas (Python)

```
┌────────────────────────────────┬──────────┬──────────┬─────────┬─────────┬────────────┐
│ Name                           │ Wall/Run │  CPU/Run │ mWd/Run │ Speedup │ vs Fastest │
├────────────────────────────────┼──────────┼──────────┼─────────┼─────────┼────────────┤
│ Filter/high_value (pandas)     │ 264.78µs │ 263.81µs │ 394.57w │   1.00x │       100% │
│ Group/category_region (pandas) │ 870.91µs │ 868.62µs │  1.56kw │   0.30x │       329% │
│ Join/customer_lookup (pandas)  │   1.67ms │   1.67ms │  1.99kw │   0.16x │       632% │
│ Sort/amount_desc (pandas)      │   3.13ms │   3.12ms │  3.80kw │   0.08x │      1180% │
└────────────────────────────────┴──────────┴──────────┴─────────┴─────────┴────────────┘
```
